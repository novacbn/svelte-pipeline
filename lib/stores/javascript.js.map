{
  "version": 3,
  "sources": ["src/stores/javascript.ts"],
  "sourcesContent": ["import {derived, writable} from \"svelte/store\";\n\nimport type {\n    IPipelineContext,\n    IPipelineError,\n    IPipelineImports,\n    IPipelineModule,\n    IPipelineOptions,\n    IPipelineStore,\n    IPipelineEvaluated,\n    IPipelineValidated,\n} from \"./pipeline\";\n\nimport {\n    PIPELINE_MODES,\n    PIPELINE_RESULT_TYPES,\n    evaluate_code,\n    make_require,\n    validate_code,\n} from \"./pipeline\";\n\ntype IJavascriptExport = {[key: string]: any};\n\nexport interface IPipelineJavascriptModule extends IPipelineModule<IJavascriptExport> {}\n\nexport interface IPipelineJavascriptOptions extends IPipelineOptions {}\n\nexport interface IPipelineJavascriptEvaluated extends IPipelineEvaluated<IJavascriptExport> {}\n\nexport interface IPipelineJavascriptStore extends IPipelineStore<IJavascriptExport> {}\n\nexport const PIPELINE_JAVASCRIPT_CONTEXT: IPipelineContext = {};\n\nexport const PIPELINE_JAVASCRIPT_IMPORTS: IPipelineImports = {};\n\nfunction PipelineOptions(options: Partial<IPipelineOptions> = {}): IPipelineOptions {\n    const {context = {}, imports = {}, mode = PIPELINE_MODES.evaluate} = options;\n    const require = make_require({...PIPELINE_JAVASCRIPT_IMPORTS, ...imports});\n\n    return {\n        mode,\n        imports: {},\n        context: {\n            ...PIPELINE_JAVASCRIPT_CONTEXT,\n            ...context,\n            require,\n        },\n    };\n}\n\nexport function pipeline_javascript(options?: Partial<IPipelineOptions>): IPipelineJavascriptStore {\n    const {context, mode} = PipelineOptions(options);\n    const writable_store = writable<string>(\"\");\n\n    const derived_store = derived(writable_store, (script: string) => {\n        if (!script) return null;\n\n        const [validated, message] = validate_code(script);\n\n        if (!validated) return {message, type: PIPELINE_RESULT_TYPES.error} as IPipelineError;\n        if (mode === PIPELINE_MODES.validate) {\n            return {type: PIPELINE_RESULT_TYPES.validated} as IPipelineValidated;\n        }\n\n        const [evaluated, module] = evaluate_code(script, context);\n        if (!evaluated) {\n            return {message: module, type: PIPELINE_RESULT_TYPES.error} as IPipelineError;\n        }\n\n        return {\n            module: module as IPipelineModule<any>,\n            type: PIPELINE_RESULT_TYPES.evaluated,\n        } as IPipelineJavascriptEvaluated;\n    });\n\n    return {\n        set: writable_store.set,\n        subscribe: derived_store.subscribe,\n        update: writable_store.update,\n    };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAgC;AAahC,iBAMO;AAYA,MAAM,8BAAgD;AAEtD,MAAM,8BAAgD;AAE7D,yBAAyB,UAAqC;AAC1D,QAAM,CAAC,UAAU,IAAI,UAAU,IAAI,OAAO,wBAAe,YAAY;AACrE,QAAM,WAAU,sBAAa,IAAI,gCAAgC;AAEjE,SAAO;AAAA,IACH;AAAA,IACA,SAAS;AAAA,IACT,SAAS;AAAA,SACF;AAAA,SACA;AAAA,MACH;AAAA;AAAA;AAAA;AAKL,6BAA6B;AAChC,QAAM,CAAC,SAAS,QAAQ,gBAAgB;AACxC,QAAM,iBAAiB,eAAiB;AAExC,QAAM,gBAAgB,cAAQ,gBAAgB,CAAC;AAC3C,QAAI,CAAC;AAAQ,aAAO;AAEpB,UAAM,CAAC,WAAW,WAAW,uBAAc;AAE3C,QAAI,CAAC;AAAW,aAAO,CAAC,SAAS,MAAM,+BAAsB;AAC7D,QAAI,SAAS,wBAAe;AACxB,aAAO,CAAC,MAAM,+BAAsB;AAAA;AAGxC,UAAM,CAAC,WAAW,WAAU,uBAAc,QAAQ;AAClD,QAAI,CAAC;AACD,aAAO,CAAC,SAAS,SAAQ,MAAM,+BAAsB;AAAA;AAGzD,WAAO;AAAA,MACH,QAAQ;AAAA,MACR,MAAM,+BAAsB;AAAA;AAAA;AAIpC,SAAO;AAAA,IACH,KAAK,eAAe;AAAA,IACpB,WAAW,cAAc;AAAA,IACzB,QAAQ,eAAe;AAAA;AAAA;",
  "names": []
}
